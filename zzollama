#!/usr/bin/env bash

fzf_ollama_models() {
	running=$(ollama ps | awk 'NR > 1 {print $1}' | sort)
	models=$(ollama ls | awk 'NR > 1 {print $1}' | sort)

	ollama ls | awk 'NR > 1 {print $1}' |
		fzf \
			--prompt="Choose model: " \
			--preview='echo "=== Model Info ==="; ollama show $(echo {} | awk "{print \$1}"); echo \${running}' \
			--preview-window=right:70%

	# ollama ls | awk 'NR > 1 {print $1}' |
	# 	fzf --prompt="Choose model: " \
	# 		--preview='echo "=== Model Info ==="; ollama show $(echo {} | awk "{print \$1}")' \
	# 		--preview-window=right:70%
}

fzf_ollama_action() {
	echo -e "run\nstop\nrm\nshow\npull" | fzf --prompt="Choose action: "
}

model=$(fzf_ollama_models)
[[ -z "$model" ]] && echo "‚ùå No model selected." && exit 1

action=$(fzf_ollama_action)
[[ -z "$action" ]] && echo "‚ùå No action selected." && exit 1

case "$action" in
run)
	echo "ollama run $model"
	echo "üöÄ Running model: $model"
	ollama run "$model"
	;;
show)
	echo "ollama show $model"
	echo "üöÄ Model Info: $model"
	ollama show "$model"
	;;
pull)
	echo "ollama pull $model"
	echo "üöÄ Pulling Model: $model"
	ollama pull "$model"
	;;
stop)
	echo "ollama stop $model"
	echo "‚èπÔ∏è Stopping model: $model"
	ollama stop "$model"
	;;
rm)
	echo "ollama rm $model"
	echo "‚ö†Ô∏è You are about to delete model: $model"
	read -p "Are you sure? (y/N): " confirm
	if [[ "$confirm" =~ ^[Yy]$ ]]; then
		echo "üóëÔ∏è Removing model: $model"
		ollama rm "$model"
	else
		echo "‚ùé Delete canceled."
	fi
	;;
*)
	echo "‚ùì Unknown action: $action"
	;;
esac
